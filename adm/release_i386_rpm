#!/bin/sh
#
# $Id: release_i386_rpm 352 2001-11-06 20:00:01Z blais $
#

if [ ! -d "tools" ]; then
     echo "You must be running this script from the topdir directory."
     exit 1;
fi

# Note: this script assume that release_bin has already been called.

echo "Getting version number"
VERSION=`tools/get_version`
echo "   Version is " $VERSION

echo "Creating spec file"
cp tools/xxdiff-rpm.spec /usr/src/redhat/SPECS/xxdiff-$VERSION.spec

echo "Copying pristine build"
PRISTINE=../xxdiff-$VERSION.tar.gz
if [ ! -f "$PRISTINE" ]; then
     echo "You must run release_src before running this script."
fi
cp $PRISTINE /usr/src/redhat/SOURCES

echo "Building binary package"
rpm -ba --nodeps /usr/src/redhat/SPECS/xxdiff-$VERSION.spec
# Note: we use nodeps here because tmake package is not quite common yet under 
# rh-7.1.

echo "Copy binary package home"
DEST=/tmp
cp /usr/src/redhat/RPMS/i386/xxdiff-$VERSION*.i386.rpm ${DEST}
chmod 777 ${DEST}/xxdiff-$VERSION*.i386.rpm

cp /usr/src/redhat/SRPMS/xxdiff-$VERSION*.src.rpm ${DEST}
chmod 777 ${DEST}/xxdiff-$VERSION*.src.rpm

echo "Packages should be in $DEST."
echo "Done."
